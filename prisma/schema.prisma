generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String  @id @default(cuid())
  discordId     String  @unique
  username      String
  discriminator String?
  email         String?
  avatar        String?
  handler       String  @unique

  isPublic     Boolean  @default(false)
  description  String?
  link         String?
  contactLinks String[] @default([])
  contactEmail String?
  country      String?
  name         String?
  title        String?
  tags         String[]
  englishLevel String?
  availability String[] @default([])
  yoe          Int?

  roles              String[]
  joinedServerAt     DateTime?
  profileActivatedAt DateTime?

  postsCreated Post[] @relation("PostsCreated")
  postsUpdated Post[] @relation("PostsUpdated")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([handler])
  @@index([discordId])
}

model Post {
  id        String   @id @default(cuid())
  title     String
  iframe    String
  sourceUrl String?  // Original URL before conversion to iframe
  embeddable Boolean @default(true) // Whether the embed URL is accessible
  
  createdBy   User?    @relation("PostsCreated", fields: [createdById], references: [id])
  createdById String?
  updatedBy   User?    @relation("PostsUpdated", fields: [updatedById], references: [id])
  updatedById String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  status    PostStatus @default(PENDING)
}

enum PostStatus {
  PENDING
  APPROVED
  REJECTED
}
